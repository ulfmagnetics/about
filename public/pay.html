<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Ulf Magnetics, Inc. - Pay</title>

    <!-- Bootstrap -->
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="about.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class='container'>
      <div class='page-header'>
        <h1>Ulf Magnetics, Inc. <small>established 2002</small></h1>
        <h4>
          Builders of interesting and occasionally
          useful technology (mostly software.)
        </h4>
      </div>

      <div class='row'>
        <div class='col-xs-8'>
          <div class='jumbotron'>
            <p class='lead'>
              Please use the following form to make a payment.
            </p>

            <form action='/charge' method='POST' id='payment-form' class='form-horizontal'>
              <span class='payment-errors'></span>

              <div class='form-group'>
                <label for='input-amount-usd' class='col-md-4 control-label'>
                  Amount of Payment (USD)
                </label>
                <div class='col-md-4'>
                  <input type='text' size='10' id='input-amount-usd' name='amount_usd' value='$'>
                </div>
              </div>

              <div class='form-group'>
                <label for='input-memo' class='col-md-4 control-label'>
                  Memo (optional)
                </label>
                <div class='col-md-4'>
                  <input type='text' size='30' id='input-memo' name='memo' placeholder='e.g. invoice number'>
                </div>
              </div>

              <div class='form-group'>
                <label for='input-number' class='col-md-4 control-label'>
                  Card Number
                </label>
                <div class='col-md-4'>
                  <input type='text' size='20' id='input-number' data-stripe='number'>
                </div>
              </div>

              <div class='form-group'>
                <label for='input-expmonth' class='col-md-4 control-label'>
                  Expiration (MM/YY)
                </label>
                <div class='col-md-4'>
                  <input type='text' size='2' id='input-expmonth' data-stripe='exp_month'>
                  <span>&nbsp;/&nbsp;</span>
                  <input type='text' size='2' id='input-expyear' data-stripe='exp_year'>
                </div>
              </div>

              <div class='form-group'>
                <label for='input-cvc' class='col-md-4 control-label'>
                  <span>CVC</span>
                </label>
                <div class='col-md-4'>
                  <input type='text' size='4' id='input-cvc' data-stripe='cvc'>
                </div>
              </div>


              <div class='form-group'>
                <div class='col-md-offset-4 col-md-4'>
                  <input type='submit' class='btn btn-primary submit' value='Submit Payment'>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>


      <div class='page-footer'>
        &copy; 2016 Ulf Magnetics, Inc. (no one receiving)
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap.min.js"></script>
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
    <script type="text/javascript">
      Stripe.setPublishableKey('pk_test_eZxV6q80NOAWDuTgCR8tw6P5');
      //Stripe.setPublishableKey('pk_live_V2VW90lkicPOQUvy7OzeL6cr');

      $(function() {
        var $form = $('#payment-form');
        $form.submit(function(event) {
          // Disable the submit button to prevent repeated clicks:
          $form.find('.submit').prop('disabled', true);

          // TODO validate amount of payment

          // Request a token from Stripe:
          Stripe.card.createToken($form, stripeResponseHandler);

          // Prevent the form from being submitted:
          return false;
        });
      });

      function stripeResponseHandler(status, response) {
        // Grab the form:
        var $form = $('#payment-form');

        if (response.error) { // Problem!

          // Show the errors on the form:
          $form.find('.payment-errors').text(response.error.message);
          $form.find('.submit').prop('disabled', false); // Re-enable submission

        } else { // Token was created!

          // Get the token ID:
          var token = response.id;

          // Insert the token ID into the form so it gets submitted to the server:
          $form.append($('<input type="hidden" name="stripeToken">').val(token));

          // Submit the form:
          $form.get(0).submit();
        }
      };
    </script>
  </body>
</html>
